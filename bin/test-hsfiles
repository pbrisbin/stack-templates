#!/bin/sh
set -e

if [ -z "$1" ]; then
  echo "usage: test-hsfiles NAME" >&2
  exit 64
fi

template=$PWD/$1.hsfiles

src=$(mktemp -d)
trap 'rm -rf $src' EXIT

cd "$src"

dropdb myapp || true
dropdb myapp_test || true

set -x
stack new \
  --resolver lts-6.5 \
  --omit-packages \
  myapp "$template"
cd myapp
make setup
bin/stack test
